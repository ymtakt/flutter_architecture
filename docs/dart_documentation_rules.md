# 本プロジェクト全体に常に適用されるルール

## 2. コメント及びドキュメンテーション

### 2.1 基本ルール

- **ドキュメントコメント**: `_` から始まらないすべての public なクラス、メソッド・関数、変数には `///` で始まるドキュメントコメントを書いてください。
- **口調**: 口調は「だ・である」調で統一します。
- **文章構造**: あえて体言止めにするもの等以外は、日本語として正しい文として成立する文章を書きます。通常のコメント (`//`) もドキュメントコメント (`///`) も例外はありません。
- **文末**: すべてのコメント及びドキュメンテーションは、例外なく、必ず「。」で、または、半角英数字で終わる場合は「.」で終わります。
- **インラインコメント**: インラインのコメントも充実させますが、ある処理の行に続けて書くタイプのコメントは書かないでください。その処理の前の行に書きます。
- **制御構文**: `if`、`for`、`while`、`switch` などの制御構文が登場したら、必ずその前にコメントを書き、何のための制御なのかを明確にします。
- **作法**: Dart のドキュメンテーションについては[Effective Dart: Documentation](https://dart.dev/effective-dart/documentation)に従います。

### 2.2 ドキュメントコメントの書き方

#### 最初の文は要約

ドキュメントコメントの最初の文は、そのクラス・メソッド・関数・変数が何をするものなのかを簡潔に要約します。この最初の文は独立した段落として記述します。

```dart
/// ユーザーの認証情報を検証する。
///
/// [username] と [password] を受け取り、データベースに保存されている情報と
/// 照合して有効性を確認する。認証に失敗した場合は [AuthException] を投げる。
bool validateCredentials(String username, String password) {
  // ...
}
```

#### 関数やメソッドは動詞で始める

関数やメソッドのドキュメントコメントは、その機能を表す動詞から始めます。

```dart
/// 指定されたパスのファイルを削除する。
///
/// ファイルが見つからない場合は [IOError] を、ファイルは存在するが削除できない
/// 場合は [PermissionError] を投げる。
void delete(String path) {
  // ...
}

/// すべての要素が [predicate] を満たす場合に `true` を返す。
bool all(bool predicate(T element)) => ...
```

#### 真偽値以外の変数は名詞句で始める

真偽値以外の変数やプロパティのドキュメントコメントは、名詞句で始めます。

```dart
/// 日曜日を `0` とした 1 週間における現在の曜日の整数値。
int weekday;

/// 当該ページにおけるチェック済みボタンの数。
int get checkedCount => ...
```

#### 真偽値変数は「〜かどうか」で始める

真偽値の変数やプロパティのドキュメントコメントは、「〜かどうか」という表現で始めます。

```dart
/// 現在モーダルがユーザーに表示されているかどうか。
bool isVisible;

/// 画面遷移を行う際に、ユーザーの意図を確認すべきかどうか。
bool get shouldConfirm => ...
```

#### 角括弧で参照を表現する

ドキュメントコメント内で変数、メソッド、型名などを参照する場合は、角括弧 `[]` で囲みます。これにより、IDE でのコードナビゲーションが可能になります。

```dart
/// [StateError] を投げる条件は...
/// [anotherMethod()] に似ているが...

/// [Duration.inDays] に似ているが、小数の日数も処理する。
```

#### サンプルコードを含める

使用例や典型的な入出力の例を示すサンプルコードを含めると理解が深まります。

````dart
/// 2つの数値のうち小さい方を返す。
///
/// ```dart
/// min(5, 3) == 3
/// ```
num min(num a, num b) => ...
````

#### Markdown 記法を活用する

ドキュメントコメントは Markdown 記法に対応しています。リスト、表、強調などを適切に使用してください。

```dart
/// ユーザーアカウントを表すクラス。
///
/// アカウントには以下の状態があります:
/// - `active`: アクティブなアカウント
/// - `suspended`: 一時停止中のアカウント
/// - `closed`: 閉鎖されたアカウント
///
/// **注意**: 一度閉鎖されたアカウントは再開できません。
class UserAccount {
  // ...
}
```

### 2.3 含めるべき内容

ドキュメントコメントには以下の情報を適宜含めてください:

- **概念や機能の説明**: クラスや関数が表す概念や提供する機能の説明
- **インターフェースの説明**: 利用方法の概要
- **入力パラメータ**:
  - どのような型か
  - 必須か任意か
  - その概念はどんなものか
- **出力**:
  - 処理の結果、何が返ってくるのか
- **例外・エラー**:
  - どのような例外やエラーが発生し得るか
- **使用例**:
  - 典型的な使用方法や入出力の例

### 2.4 通常コメントとの使い分け

- **ドキュメントコメント (`///`)**: クラス、メソッド、関数、変数の説明や使い方を記述する際に使用します。
- **通常コメント (`//`)**: 処理の文脈を補足する内容や、実装の詳細を説明する際に使用します。

```dart
/// HTTP リクエストを送信し、レスポンスを返す。
///
/// [url] に対して GET リクエストを実行する。タイムアウトは [timeout] ミリ秒。
Future<Response> get(String url, {int timeout = 5000}) async {
  // URLの検証
  if (!_isValidUrl(url)) {
    throw InvalidUrlException('無効な URL 形式です。');
  }

  // タイムアウト設定の適用
  final client = HttpClient()..connectionTimeout = Duration(milliseconds: timeout);

  // ユーザーエージェントの設定
  client.userAgent = 'MyApp/1.0';

  // レスポンスのステータスコードが成功でない場合はエラーを投げる
  if (response.statusCode >= 400) {
    throw HttpException('リクエストに失敗しました: ${response.statusCode}');
  }

  // ... 以下実装
}
```

### 2.5 テストコードのコメント

テストコードには特に丁寧なコメントを記述し、テストの意図と期待される結果を明確にします。

#### テストの構造化コメント

各テストケースには以下の構造に従ったコメントを記述します:

```dart
void test('ユーザー認証が成功する場合', () {
  // 前提: 有効なユーザー認証情報
  final validCredentials = UserCredentials('test_user', 'correct_password');
  final authService = MockAuthService();

  // 期待値: 認証が成功しtrueが返される
  when(authService.authenticate).thenReturn(true);

  // arrange: テスト対象のクラスをセットアップ
  final sut = UserAuthenticator(authService);

  // act: テスト対象のメソッドを実行
  final result = sut.login(validCredentials);

  // assert: 結果を検証
  expect(result, true);
});
```

#### テストコメントの原則

- **前提**: テストの前提条件や初期状態を明記します。
- **期待値**: テストが期待する結果や振る舞いを明記します。
- **arrange**: テストの準備段階（モックのセットアップ、テスト対象の初期化など）を示します。
- **act**: テスト対象のメソッドや機能を実行する部分を示します。
- **assert**: 結果を検証する部分を示します。

このコメント構造により、テストの目的とロジックが明確になり、他の開発者が理解しやすくなります。また、テストが失敗した際の原因特定も容易になります。
